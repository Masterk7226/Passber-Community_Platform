<!DOCTYPE html>
<html>

<head>
  <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
  <script src="https://openlayers.org/en/v4.6.4/build/ol.js"></script>
  <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script src="../js/LocationMap.js"></script>
</head>
<style media="screen">
  header {
    display: block;
    background: rgb(92, 172, 235);
    color: white;
    padding-left: 10px;
    padding-top: 5px;
    padding-bottom: 5px;
  }
</style>

<body>
  <header style="height:80px;">
    <h1 style="float: left; width: 60%;">Create Event Form</h1>
    <!-- <div id="UserProfile" style="padding-top: 20px; float: right; width:40%">aaa</div> -->
    <!-- <button type="button" id="SignOut" name="button">Sign-Out</button> -->
  </header>

  <div class="container">
    <div class="form-site" style="padding-top:10px; padding-left:20px; ">
      <form id="evt_create" method="post" action="">
        <table>
          <tr>
            <td><label for="evt_logo">Logo: </label></td>
            <td><input type="file" name="evt_logo" id="evt_logo"/></td>
          </tr>
          <tr>
            <td><label for="evt_name">Name: </label> </td>
            <td><input type="text" name="evt_name" /> </td>
          </tr>

          <tr>
            <td><label for="date_start">Date of Start: </label> </td>
            <td><input type="date" name="date_start" /><br/></td>
          </tr>
          <tr>
            <td><label for="date_end">Date of End: </label></td>
            <td><input type="date" name="date_end" /><br/></td>
          </tr>
          <tr>
            <td><label for="evt_address">Address: </label></td>
            <td><textarea name="evt_address" cols="50" rows="4"></textarea><br/></td>
          </tr>
          <tr>
            <td><label for="evt_content">Content: </label></td>
            <td><textarea name="evt_content" cols="50" rows="4"></textarea><br/></td>
          </tr>
          <tr>
            <td><label for="deadline">Deadline: </label></td>
            <td><input type="date" name="deadline" /><br/></td>
          </tr>
          <tr>
            <td><label for="longtitude">Longtitude:</label></td>
            <td><input type="number" name="longtitude" max="180" step="0.000001" /><br/></td>
          </tr>
          <tr>
            <td><label for="latitude">Latitude:</label></td>
            <td><input type="number" name="latitude" max="90" step="0.000001" /><br/></td>
          </tr>
          <tr>
            <td><button type="button" id="mkMap">USE MAP</button></td>
            <td><button type="button" id="hideMap">HIDE MAP</button></td>
          </tr>
        </table>


        <div id="map" style="height:300px;width:300px;"></div>
        <fieldset id="feesfield" style="width:600px;">
          <legend>Fees</legend>
          <button type="button" id="addfee">ADD FEE</button><br/>

          <label for="feeName0">Type of Membership: </label>
          <input type="text" id="feeName0" class="countfee" name="feeName0" />

          <label for="feeAmt0">Amount: </label>
          <input type="text" id="feeAmt0" name="feeAmt0" /><br />
        </fieldset>
        <br/>

        <input id="Submit" type="submit" value="CREATE EVENT" />
        <input type="reset" id="btn_reset" value="RESET FORM" />
      </form>
      <br/>

      <hr/>
      <a href="ABCClub.html">Back</a><br/>
      <p id="getName"></p>
      <button type="button" id="btn_logout">Logout</button>

    </div>
  </div>

  <script>
    var feeCount = 1;
    var deletedFee = [];
    $(document).ready(function() {

      var lm = new locationMap('map', $('input[name="longtitude"]'), $('input[name="latitude"]'));
      var showMap = $('#mkMap');
      var hideMap = $('#hideMap');
      var map = $('#map');

      hideMap.hide();
      map.hide();

      showMap.click(function() {
        hideMap.show();
        map.show();
        $(this).hide();
      })

      hideMap.click(function() {
        showMap.show();
        map.hide();
        $(this).hide();
      })

      $('#addfee').click(function() {
        var feeID = feeCount;
        if (deletedFee.length != 0)
          feeID = deletedFee.shift();
        var template = '<label for="feeName' + feeID + ' " class=countfee >Type of Membership: </label>' +
          '<input type="text" id="feeName' + feeID + '" name="feeName' + feeID + '" />' +
          '<label for="feeAmt' + feeID + '">Amount: </label>' +
          '<input type="text" id="feeAmt' + feeID + '" name="feeAmt' + feeID + '" />' +
          '<button type="button" id="fee' + feeID + '" onclick="deleteFee(this)">X</button><br />';
        $('fieldset').append(template);
        feeCount++;
      });

      $('#evt_create').submit(function() {
        var submitObj = {
          evt_name: $('input[name="evt_name"]').val(),
          evt_address: $('textarea[name="evt_address"]').val(),
          evt_content: $('textarea[name="evt_content"]').val(),
          deadline: $('input[name="deadline"]').val(),
          date_start: $('input[name="date_start"]').val(),
          date_end: $('input[name="date_end"]').val(),
          longtitude: $('input[name="longtitude"]').val(),
          latitude: $('input[name="latitude"]').val(),
          fees: []
        };
        for (var i = 0; i < feeCount + deletedFee.length; i++) {
          if (deletedFee.indexOf(i + '') == -1) {
            submitObj.fees[$('#feeName' + i).val()] = $('#feeAmt' + i).val();
          }
        }
        return false;
      });
    });

    function deleteFee(a) {
      var id = $(a).attr('id');
      id = id.replace('fee', '');
      $('#feeName' + id).remove();
      $('#feeAmt' + id).remove();
      $('label').filter(function() {
        return (isFeeName(this, id) || isFeeAmt(this, id));
      }).remove();
      $(a).next().remove();
      $(a).remove();
      feeCount--;
      if (id != feeCount)
        deletedFee.push(id);
    }

    function isFeeName(dom, id) {
      return ($(dom).attr('for') == 'feeName' + id);
    }

    function isFeeAmt(dom, id) {
      return ($(dom).attr('for') == 'feeAmt' + id);
    }
  </script>

</body>
</html>



<script src="../js/CreateEventForm.js"></script>
<script src="js/Basic.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.9.1/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDg7_zf2I5u-SEd0aC0LYeHeJ2reer3dRo",
    authDomain: "onecommunity-a0d82.firebaseapp.com",
    databaseURL: "https://onecommunity-a0d82.firebaseio.com",
    projectId: "onecommunity-a0d82",
    storageBucket: "onecommunity-a0d82.appspot.com",
    messagingSenderId: "785419227077"
  };
  firebase.initializeApp(config);
</script>
